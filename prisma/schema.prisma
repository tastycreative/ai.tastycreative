// prisma/schema.prisma - Complete schema for your setup
generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  clerkId   String   @unique // Clerk user ID
  email     String?
  firstName String?
  lastName  String?
  imageUrl  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  influencers InfluencerLoRA[]
  jobs        GenerationJob[]

  @@map("users")
}

model InfluencerLoRA {
  id               String     @id @default(cuid())
  clerkId          String     // Link to Clerk user
  name             String
  displayName      String
  fileName         String     @unique
  originalFileName String
  fileSize         Int
  uploadedAt       DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  description      String?
  thumbnailUrl     String?
  isActive         Boolean    @default(true)
  usageCount       Int        @default(0)
  comfyUIPath      String?
  syncStatus       SyncStatus @default(PENDING)
  lastUsedAt       DateTime?

  // Relations
  user User @relation(fields: [clerkId], references: [clerkId], onDelete: Cascade)

  @@map("influencer_loras")
}

model GenerationJob {
  id              String    @id @default(cuid())
  clerkId         String    // Link to Clerk user
  status          JobStatus @default(PENDING)
  progress        Int?      @default(0)
  resultUrls      String[]  @default([])
  error           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  lastChecked     DateTime?
  comfyUIPromptId String?
  params          Json?     // Store generation parameters as JSON

  // Relations
  user User @relation(fields: [clerkId], references: [clerkId], onDelete: Cascade)

  @@map("generation_jobs")
}

enum SyncStatus {
  PENDING
  SYNCED
  MISSING
  ERROR
}

enum JobStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}